<div class="container">
  <nav class="main-nav">
    <%= link_to "Forms", forms_path %>
    <%= link_to "Sections", sections_path %>
    <%= link_to "Questions", questions_path %>
    <%= link_to "Answers", answers_path %>
    <%= link_to "Responses", responses_path %>
    <%= link_to "Metrics", metrics_path, class: "active" %>
    <%= link_to "Dashboards", dashboards_path %>
    <%= link_to "Logout", logout_path, data: { "turbo-method": :delete } %>
  </nav>

  <% if logged_in? %>
    <div class="index-header">
      <h1>Metrics</h1>
      <%= link_to "New Metric", new_metric_path(namespace: @current_namespace), class: "btn btn-primary" %>
    </div>

    <!-- Breadcrumb Navigation -->
    <% if @breadcrumbs.length > 1 %>
      <div class="breadcrumb-nav">
        <% @breadcrumbs.each_with_index do |(name, path), index| %>
          <% if index == @breadcrumbs.length - 1 %>
            <span class="breadcrumb-current"><%= name %></span>
          <% else %>
            <%= link_to name, path, class: "breadcrumb-link" %>
            <span class="breadcrumb-separator">‚Ä∫</span>
          <% end %>
        <% end %>
      </div>
    <% end %>

    <!-- Folder Navigation -->
    <% if @folders.any? %>
      <div class="folders-section">
        <h3>Folders</h3>
        <div class="folder-grid">
          <% @folders.each do |folder| %>
            <% folder_namespace = @current_namespace.present? ? "#{@current_namespace}.#{folder}" : folder %>
            <div class="folder-item">
              <%= link_to metrics_path(namespace: folder_namespace), class: "folder-link" do %>
                <span class="folder-icon">üìÅ</span>
                <span class="folder-name"><%= folder %></span>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Items in Current Namespace -->
    <% if @items.any? %>
      <div class="items-section">
        <h3><%= @current_namespace.present? ? "Metrics in #{@current_namespace}" : "Metrics in Root" %></h3>
        <div class="index-grid">
          <% @items.each do |metric| %>
            <div class="index-card">
              <h4><%= link_to metric.display_name, metric_path(metric) %></h4>
              <p>Function: <%= metric.function.capitalize %></p>
              <p><%= metric.resolution %> ‚Ä¢ <%= metric.width %></p>
              <div class="index-card-actions">
                <%= link_to "View", metric_path(metric) %>
                <%= link_to "Edit", edit_metric_path(metric) %>
                <%= link_to "Delete", soft_delete_metric_path(metric), 
                    data: { "turbo-method": :patch, confirm: "Are you sure?" }, 
                    class: "btn", 
                    style: "background-color: var(--error); color: var(--white);" %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% elsif @folders.empty? %>
      <div class="empty-state">
        <h3>No metrics yet</h3>
        <p>Create your first metric to get started!</p>
        <%= link_to "Create Metric", new_metric_path(namespace: @current_namespace), class: "btn btn-primary" %>
      </div>
    <% end %>
  <% end %>
</div>