<div class="container">
  <%= render 'shared/main_nav' %>

  <div class="index-header">
    <h1><%= @remember.description %></h1>
    <div style="display: flex; gap: 0.5rem;">
      <%= link_to "Edit", edit_remember_path(@remember), class: "btn btn-primary" %>
    </div>
  </div>

  <%= link_to "<- Back to Remembers", remembers_path(namespace: @remember.namespace), class: "back-link" %>

  <!-- Action buttons at top -->
  <div class="card">
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
      <%= link_to "ðŸ“Œ Pin", pin_remember_path(@remember),
          data: { "turbo-method": :patch },
          class: "btn btn-secondary" %>
      <%= link_to "ðŸ”„ Float", float_remember_path(@remember),
          data: { "turbo-method": :patch },
          class: "btn btn-secondary" %>
      <%= link_to "â¬† Bump Up", bump_up_remember_path(@remember),
          data: { "turbo-method": :patch },
          class: "btn btn-secondary" %>
      <%= link_to "â¬‡ Bump Down", bump_down_remember_path(@remember),
          data: { "turbo-method": :patch },
          class: "btn btn-secondary" %>
      <%= link_to "ðŸ—„ Retire", retire_remember_path(@remember),
          data: { "turbo-method": :patch, confirm: "Retire this remember?" },
          class: "btn btn-secondary" %>
      <span style="margin-left: auto; color: var(--text-secondary);">
        <% case @remember.state %>
        <% when "pinned" %>
          ðŸ“Œ Pinned (<%= format('%.2f', @remember.decay) %>)
        <% when "floating" %>
          ðŸ”„ Floating (<%= format('%.2f', @remember.decay) %>)
        <% when "retired" %>
          ðŸ—„ Retired
        <% end %>
      </span>
    </div>
  </div>

  <% unless @remember.state == "retired" %>
    <!-- Decay slider -->
    <% min_decay = current_user.user_setting&.remember_min_decay || 0.01 %>
    <div class="card">
      <h3 style="margin: 0 0 0.5rem 0;">Set Decay</h3>
      <%= form_with url: set_decay_remember_path(@remember), method: :patch, local: true do |f| %>
        <div style="display: flex; align-items: center; gap: 0.75rem;">
          <span style="min-width: 2.5rem; text-align: right;"><%= min_decay %></span>
          <%= range_field_tag :decay, @remember.decay,
              min: min_decay,
              max: 1.0,
              step: 0.01,
              id: "decay-slider",
              style: "flex: 1;",
              oninput: "document.getElementById('decay-value').textContent = parseFloat(this.value).toFixed(2)" %>
          <span style="min-width: 2rem;">1.0</span>
          <span id="decay-value" style="min-width: 2.5rem; font-weight: bold;"><%= format('%.2f', @remember.decay) %></span>
          <%= submit_tag "Set & Pin", class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if @remember.background.present? %>
    <div class="card">
      <h3>Background</h3>
      <p style="white-space: pre-wrap;"><%= @remember.background %></p>
    </div>
  <% end %>
</div>
