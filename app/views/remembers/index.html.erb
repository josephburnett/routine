<div class="container">
  <%= render 'shared/main_nav' %>

  <% if logged_in? %>
    <div class="index-header">
      <h1>Remembers</h1>
      <%= link_to "New Remember", new_remember_path(namespace: @current_namespace), class: "btn btn-primary" %>
    </div>

    <!-- Show Retired Toggle -->
    <div style="margin-bottom: 1rem;">
      <% if @show_retired %>
        <%= link_to "Hide Retired", remembers_path(namespace: @current_namespace), class: "btn btn-secondary" %>
      <% else %>
        <%= link_to "Show Retired", remembers_path(namespace: @current_namespace, show_retired: true), class: "btn btn-secondary" %>
      <% end %>
    </div>

    <!-- Breadcrumb Navigation -->
    <% if @breadcrumbs.length > 1 %>
      <div class="breadcrumb-nav">
        <% @breadcrumbs.each_with_index do |(name, path), index| %>
          <% if index == @breadcrumbs.length - 1 %>
            <span class="breadcrumb-current"><%= name %></span>
          <% else %>
            <%= link_to name, path, class: "breadcrumb-link" %>
            <span class="breadcrumb-separator">></span>
          <% end %>
        <% end %>
      </div>
    <% end %>

    <!-- Folder Navigation -->
    <% if @folders.any? %>
      <div class="folders-section">
        <h3>Folders</h3>
        <div class="folder-grid">
          <% @folders.each do |folder| %>
            <% folder_namespace = @current_namespace.present? ? "#{@current_namespace}.#{folder}" : folder %>
            <div class="folder-item">
              <%= link_to remembers_path(namespace: folder_namespace, show_retired: @show_retired), class: "folder-link" do %>
                <span class="folder-icon">ğŸ“</span>
                <span class="folder-name"><%= folder %></span>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Remembers List -->
    <% if @items.any? %>
      <div class="items-section">
        <h3><%= @current_namespace.present? ? "Remembers in #{@current_namespace}" : "Remembers in Root" %></h3>
        <div class="remember-list">
          <% @items.each do |remember| %>
            <div class="remember-item" style="display: flex; align-items: center; justify-content: space-between; padding: 0.75rem; border-bottom: 1px solid var(--border); <%= remember.state == 'retired' ? 'opacity: 0.5;' : '' %>">
              <div style="flex: 1;">
                <%= link_to remember.description, remember_path(remember), style: "text-decoration: none; color: inherit;" %>
                <% if remember.state == "pinned" %>
                  <span style="color: var(--primary); font-size: 0.75rem; margin-left: 0.5rem;">ğŸ“Œ pinned</span>
                <% elsif remember.state == "retired" %>
                  <span style="color: var(--text-secondary); font-size: 0.75rem; margin-left: 0.5rem;">retired</span>
                <% else %>
                  <span style="color: var(--text-secondary); font-size: 0.75rem; margin-left: 0.5rem;">(<%= format('%.0f%%', remember.decay * 100) %>)</span>
                <% end %>
              </div>
              <div class="remember-actions" style="display: flex; gap: 0.25rem;">
                <%= link_to "ğŸ“Œ", pin_remember_path(remember, show_retired: @show_retired),
                    data: { "turbo-method": :patch },
                    title: "Pin",
                    class: "btn btn-sm",
                    style: "padding: 0.25rem 0.5rem; font-size: 0.875rem;" %>
                <%= link_to "â¬†", bump_up_remember_path(remember, show_retired: @show_retired),
                    data: { "turbo-method": :patch },
                    title: "Bump Up (2x decay)",
                    class: "btn btn-sm",
                    style: "padding: 0.25rem 0.5rem; font-size: 0.875rem;" %>
                <%= link_to "â¬‡", bump_down_remember_path(remember, show_retired: @show_retired),
                    data: { "turbo-method": :patch },
                    title: "Bump Down (0.5x decay)",
                    class: "btn btn-sm",
                    style: "padding: 0.25rem 0.5rem; font-size: 0.875rem;" %>
                <%= link_to "ğŸ—„", retire_remember_path(remember, show_retired: @show_retired),
                    data: { "turbo-method": :patch, confirm: "Retire this remember?" },
                    title: "Retire",
                    class: "btn btn-sm",
                    style: "padding: 0.25rem 0.5rem; font-size: 0.875rem;" %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="empty-state">
        <h3>No remembers yet</h3>
        <p>Create your first remember to start tracking things you want to keep in mind.</p>
      </div>
    <% end %>
  <% end %>
</div>
